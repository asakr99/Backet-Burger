<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SamaBrand | ููุญุฉ ุงูุชุญูู ุงูุณุญุงุจูุฉ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    
    <!-- ููุชุจุงุช Firebase (ุงูุฅุตุฏุงุฑ 9 ุงููุชูุงูู - Compat) -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

    <style>
        body { font-family: 'Cairo', sans-serif; background-color: #f8fafc; }
        .input-field { width: 100%; padding: 12px; border-radius: 12px; border: 1px solid #e2e8f0; outline: none; transition: 0.3s; background: #fff; }
        .input-field:focus { border-color: #9333ea; box-shadow: 0 0 0 3px rgba(147, 51, 234, 0.1); }
        .sidebar-btn { text-align: right; width: 100%; padding: 12px; border-radius: 12px; transition: 0.2s; font-weight: bold; color: #64748b; margin-bottom: 5px; }
        .sidebar-btn:hover { background: #f1f5f9; color: #423064; }
        .sidebar-btn.active { background: #423064; color: white; }
        #loader { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.9); z-index: 9999; display: flex; flex-col; justify-content: center; align-items: center; }
        .spinner { border: 4px solid #f3f3f3; border-top: 4px solid #423064; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>



    <!-- ุดุงุดุฉ ุชุณุฌูู ุงูุฏุฎูู -->
    <div id="login" class="min-h-screen flex items-center justify-center p-4">
        <div class="bg-white p-10 rounded-[2rem] shadow-2xl w-full max-w-md text-center">
            <div class="w-20 h-20 bg-purple-100 text-purple-600 rounded-full flex items-center justify-center mx-auto mb-6 text-4xl">โ๏ธ</div>
            <h2 class="text-2xl font-black mb-2 text-[#423064]">ุฅุฏุงุฑุฉ SamaBrand</h2>
            <p class="text-gray-400 text-sm mb-8">ุณุฌู ุงูุฏุฎูู ุจุญุณุงุจ Firebase ููุชุญูู ุจุงููููุน</p>
            <input type="email" id="email" placeholder="ุงูุจุฑูุฏ ุงูุฅููุชุฑููู" class="input-field mb-4 text-center" dir="ltr">
            <input type="password" id="password" placeholder="ูููุฉ ุงููุฑูุฑ" class="input-field mb-4 text-center" dir="ltr">
            <button onclick="loginFirebase()" class="w-full py-4 bg-[#423064] text-white rounded-xl font-bold hover:bg-purple-800 transition shadow-lg">ุชุณุฌูู ุงูุฏุฎูู</button>
            <p id="login-error" class="text-red-500 text-xs mt-4 hidden font-bold"></p>
        </div>
    </div>

    <!-- ููุญุฉ ุงูุชุญูู ุงูุฑุฆูุณูุฉ -->
    <div id="panel" class="hidden min-h-screen flex flex-col md:flex-row">
        
        <!-- ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ -->
        <aside class="bg-white w-full md:w-64 border-l p-6 flex flex-col justify-between shadow-sm z-10">
            <div>
                <div class="text-2xl font-black text-[#423064] mb-8 px-2">ููุญุฉ ุงูุชุญูู โ๏ธ</div>
                <nav>
                    <button onclick="switchTab('home')" id="btn-home" class="sidebar-btn active">๐ ูุธุฑุฉ ุนุงูุฉ</button>
                    <button onclick="switchTab('settings')" id="btn-settings" class="sidebar-btn">๐จ ุฅุนุฏุงุฏุงุช ุงููููุน</button>
                    <button onclick="switchTab('addons')" id="btn-addons" class="sidebar-btn">๐งฉ ุงูุฅุถุงูุงุช</button>
                    <button onclick="switchTab('social')" id="btn-social" class="sidebar-btn">โจ ุงูุณูุดูุงู ููุฏูุง</button>
                    <button onclick="switchTab('sections')" id="btn-sections" class="sidebar-btn">๐ ุงูุฃูุณุงู</button>
                    <button onclick="switchTab('meals')" id="btn-meals" class="sidebar-btn">๐ ุงููุฌุจุงุช</button>
                    <button onclick="logoutFirebase()" class="sidebar-btn text-red-600 bg-red-50 hover:bg-red-100 mt-4">๐ช ุชุณุฌูู ุฎุฑูุฌ</button>
                </nav>
            </div>
            <div class="mt-8 border-t pt-4">
                <a href="index.html" target="_blank" class="flex items-center gap-2 text-sm font-bold text-gray-500 hover:text-purple-600 transition">
                    <span>ูุนุงููุฉ ุงููููุน โ</span>
                </a>
            </div>
        </aside>

        <!-- ุงููุญุชูู -->
        <main class="flex-1 p-4 md:p-8 overflow-y-auto max-h-screen">

            <!-- ุชุจููุจ: ูุธุฑุฉ ุนุงูุฉ -->
            <div id="tab-home" class="tab-content space-y-6">
                <header class="flex justify-between items-center mb-8">
                    <h1 class="text-3xl font-black text-gray-800">ูุฑุญุจุงู ุจู ๐</h1>
                    <span class="text-xs bg-green-100 text-green-700 px-3 py-1 rounded-full font-bold animate-pulse">ูุชุตู ุจุงูุณูุฑูุฑ โ</span>
                </header>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-purple-100">
                        <div class="text-gray-400 font-bold mb-2">ุนุฏุฏ ุงููุฌุจุงุช</div>
                        <div class="text-4xl font-black text-purple-600" id="stat-meals">0</div>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-blue-100">
                        <div class="text-gray-400 font-bold mb-2">ุนุฏุฏ ุงูุฃูุณุงู</div>
                        <div class="text-4xl font-black text-blue-600" id="stat-sections">0</div>
                    </div>
                </div>
                <div class="bg-blue-50 p-6 rounded-2xl border border-blue-100 text-center mt-6">
                    <p class="text-blue-800 font-bold">ุฃู ุชุบููุฑ ุชููู ุจู ููุง ุณูุธูุฑ ููุฑุงู ุนูู ุงููููุน ูุฌููุน ุงูุฒูุงุฑ ๐</p>
                </div>
            </div>

            <!-- ุชุจููุจ: ุงูุฅุนุฏุงุฏุงุช -->
            <div id="tab-settings" class="tab-content hidden space-y-6">
                <h2 class="text-2xl font-black mb-4">ุฅุนุฏุงุฏุงุช ุงููููุฉ ูุงููุงุฌูุฉ</h2>
                <div class="bg-white p-6 md:p-8 rounded-[2rem] shadow-sm border border-gray-100">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="space-y-1"><label class="text-xs font-bold text-gray-400">ุงุณู ุงููุทุนู (ุนุฑุจู)</label><input id="t_ar" class="input-field"></div>
                        <div class="space-y-1"><label class="text-xs font-bold text-gray-400">ุงุณู ุงููุทุนู (English)</label><input id="t_en" class="input-field" dir="ltr"></div>
                        <div class="space-y-1"><label class="text-xs font-bold text-gray-400">ุฑูู ุงููุงุชุณุงุจ (ุจุฏูู +)</label><input id="w" class="input-field" placeholder="966500000000"></div>
                        <div class="space-y-1"><label class="text-xs font-bold text-gray-400">ุฑุงุจุท ุงูุดุนุงุฑ (Logo URL)</label><input id="l" class="input-field"></div>
                        <div class="space-y-1 md:col-span-2"><label class="text-xs font-bold text-gray-400">ุฑุงุจุท ุฎูููุฉ ุงูููุฑู (Hero Image)</label><input id="h" class="input-field"></div>
                    </div>
                    
                    <div class="border-t my-6 pt-6">
                        <h3 class="font-bold text-purple-600 mb-4">ูุตูุต ุงููุงุฌูุฉ (Hero)</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <input id="hero_t_ar" placeholder="ุงูุนููุงู ุงูุฑุฆูุณู (ุนุฑุจู)" class="input-field">
                            <input id="hero_t_en" placeholder="Hero Title (EN)" class="input-field" dir="ltr">
                            <textarea id="hero_d_ar" placeholder="ุงููุตู (ุนุฑุจู)" class="input-field" rows="2"></textarea>
                            <textarea id="hero_d_en" placeholder="Description (EN)" class="input-field" rows="2" dir="ltr"></textarea>
                        </div>
                    </div>

                    <div class="border-t my-6 pt-6">
                        <h3 class="font-bold text-blue-600 mb-4">ุงูููุชุฑ (ุชุฐููู ุงูุตูุญุฉ)</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                            <div class="space-y-1"><label class="text-xs font-bold text-gray-400">ุนููุงู ุงูููุชุฑ (ุนุฑุจู)</label><input id="footer_title_ar" class="input-field"></div>
                            <div class="space-y-1"><label class="text-xs font-bold text-gray-400">Footer Title (EN)</label><input id="footer_title_en" class="input-field" dir="ltr"></div>
                            <div class="space-y-1"><label class="text-xs font-bold text-gray-400">ูุตู ุงูููุชุฑ (ุนุฑุจู)</label><textarea id="footer_desc_ar" class="input-field" rows="3"></textarea></div>
                            <div class="space-y-1"><label class="text-xs font-bold text-gray-400">Footer Description (EN)</label><textarea id="footer_desc_en" class="input-field" rows="3" dir="ltr"></textarea></div>
                        </div>
                        <h3 class="font-bold text-blue-600 mb-4">ุงูุฎุฑูุทุฉ ูุงูุชูุงุตู</h3>
                        <div class="mb-4"><input id="map_url" placeholder="ุฑุงุจุท ุงูุฎุฑูุทุฉ (Embed URL)" class="input-field font-mono text-xs"></div>
                        <div class="bg-gray-50 p-4 rounded-xl border border-gray-200">
                            <div class="flex gap-2 mb-2">
                                <select id="contact_type" class="p-2 rounded-lg border bg-white"><option value="phone">ูุงุชู</option><option value="email">ุฅูููู</option></select>
                                <input id="contact_val" placeholder="ุงููููุฉ" class="input-field">
                                <button onclick="addContact()" class="bg-green-600 text-white px-4 rounded-lg font-bold hover:bg-green-700">+</button>
                            </div>
                            <div id="contact-list" class="space-y-2"></div>
                        </div>
                    </div>

                    <div class="border-t my-6 pt-6">
                        <h3 class="font-bold text-green-600 mb-4">ุฒุฑ ุชุญููู ุงูุชุทุจูู ๐ฑ</h3>
                        <div class="flex gap-6 mb-4 bg-green-50 p-4 rounded-xl border border-green-100">
                            <div class="flex items-center gap-2"><input type="checkbox" id="show_app_hero" class="w-5 h-5 accent-green-600"><label for="show_app_hero" class="font-bold text-sm select-none">ุฅุธูุงุฑ ูู ุงูููุฑู</label></div>
                            <div class="flex items-center gap-2"><input type="checkbox" id="show_app_footer" class="w-5 h-5 accent-green-600"><label for="show_app_footer" class="font-bold text-sm select-none">ุฅุธูุงุฑ ูู ุงูููุชุฑ</label></div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <input id="app_txt_ar" placeholder="ูุต ุงูุฒุฑ (ุนุฑุจู)" class="input-field">
                            <input id="app_txt_en" placeholder="Button Text (EN)" class="input-field" dir="ltr">
                            <div class="md:col-span-2"><input id="app_link" placeholder="ุฑุงุจุท ุงูุชุญููู" class="input-field" dir="ltr"></div>
                        </div>
                    </div>

                    <div class="border-t my-6 pt-6">
                        <h3 class="font-bold text-blue-600 mb-4">ุญููู ุงูููููุฉ ยฉ</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <input id="copy_ar" placeholder="ุงููุต (ุนุฑุจู)" class="input-field">
                            <input id="copy_en" placeholder="Text (EN)" class="input-field" dir="ltr">
                            <div class="md:col-span-2"><input id="copy_link" placeholder="ุฑุงุจุท ุงูุญููู" class="input-field" dir="ltr"></div>
                        </div>
                    </div>

                    <button onclick="saveMain()" class="w-full bg-[#423064] text-white py-4 rounded-xl font-bold hover:shadow-lg transition mt-8">ุญูุธ ูู ุงูุฅุนุฏุงุฏุงุช ุงูุณุญุงุจูุฉ โ๏ธ</button>
                </div>
            </div>

            <!-- ุชุจููุจ: ุงูุฅุถุงูุงุช -->
            <div id="tab-addons" class="tab-content hidden space-y-6">
                <h2 class="text-2xl font-black mb-4">ูุฌููุนุงุช ุงูุฅุถุงูุงุช ๐งฉ</h2>
                <div class="bg-white p-6 rounded-[2rem] shadow-sm border border-gray-100 mb-8">
                    <h3 class="font-bold text-purple-800 mb-4">ุฅูุดุงุก ูุฌููุนุฉ ุฌุฏูุฏุฉ</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                        <input id="addon_group_ar" placeholder="ุงุณู ุงููุฌููุนุฉ (ุนุฑุจู)" class="input-field">
                        <input id="addon_group_en" placeholder="Group Name (En)" class="input-field" dir="ltr">
                        <select id="addon_type" class="input-field font-bold">
                            <option value="one">ุฎูุงุฑ ูุงุญุฏ (Radio)</option>
                            <option value="many">ุฎูุงุฑุงุช ูุชุนุฏุฏุฉ (Checkbox)</option>
                            <option value="qty">ูููุงุช (Counter)</option>
                        </select>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-xl border border-gray-200 mb-4">
                        <h4 class="text-xs font-bold text-gray-400 mb-2">ุงูุฎูุงุฑุงุช</h4>
                        <div class="flex flex-wrap gap-2 mb-2">
                            <input id="opt_name_ar" placeholder="ุงูุฎูุงุฑ (ุนุฑุจู)" class="input-field w-1/3">
                            <input id="opt_name_en" placeholder="Option (En)" class="input-field w-1/3" dir="ltr">
                            <input id="opt_price" type="number" placeholder="ุงูุณุนุฑ" class="input-field w-1/6">
                            <button onclick="addTempOption()" class="bg-blue-600 text-white px-4 rounded-lg font-bold w-1/6 hover:bg-blue-700">+</button>
                        </div>
                        <div id="temp-options-list" class="flex flex-wrap gap-2"></div>
                    </div>
                    <button onclick="saveAddonGroup()" class="w-full bg-[#423064] text-white py-3 rounded-xl font-bold hover:shadow-lg transition">ุญูุธ ุงููุฌููุนุฉ</button>
                </div>
                <div id="addons-list" class="space-y-4"></div>
            </div>

            <!-- ุชุจููุจ: ุงูุณูุดูุงู -->
            <div id="tab-social" class="tab-content hidden space-y-6">
                <h2 class="text-2xl font-black mb-4">ุฑูุงุจุท ุงูุชูุงุตู ๐ฑ</h2>
                <div class="bg-white p-6 rounded-[2rem] shadow-sm border border-gray-100">
                    <div class="flex flex-col md:flex-row gap-6 mb-8 bg-purple-50 p-6 rounded-2xl border border-purple-100">
                        <div class="flex items-center gap-3"><input type="checkbox" id="show_social_top" class="w-6 h-6 accent-purple-600"><label for="show_social_top" class="font-bold">ุฅุธูุงุฑ ุจุงูุฃุนูู</label></div>
                        <div class="flex items-center gap-3"><input type="checkbox" id="show_social_bottom" class="w-6 h-6 accent-purple-600"><label for="show_social_bottom" class="font-bold">ุฅุธูุงุฑ ุจุงูุฃุณูู</label></div>
                    </div>
                    <div class="flex flex-col md:flex-row gap-4 mb-6">
                        <select id="social_platform" class="input-field md:w-1/4 font-bold">
                            <option value="instagram">Instagram</option><option value="snapchat">Snapchat</option><option value="tiktok">TikTok</option><option value="twitter">X (Twitter)</option><option value="facebook">Facebook</option><option value="whatsapp">WhatsApp</option>
                        </select>
                        <input id="social_link" placeholder="ุงูุฑุงุจุท" class="input-field md:w-2/4 text-left" dir="ltr">
                        <button onclick="addSocialLink()" class="bg-[#423064] text-white px-6 rounded-xl font-bold hover:bg-purple-800 transition md:w-1/4">ุฅุถุงูุฉ โ</button>
                    </div>
                    <div id="social-list-admin" class="space-y-3"></div>
                    <button onclick="saveSocialSettings()" class="w-full mt-8 bg-green-600 text-white py-4 rounded-xl font-bold hover:shadow-lg transition">ุญูุธ ุงูุชุบููุฑุงุช โ</button>
                </div>
            </div>

            <!-- ุชุจููุจ: ุงูุฃูุณุงู -->
            <div id="tab-sections" class="tab-content hidden space-y-6">
                <h2 class="text-2xl font-black mb-4">ุฅุฏุงุฑุฉ ุงูุฃูุณุงู</h2>
                <div class="bg-white p-6 rounded-[2rem] shadow-sm border border-gray-100">
                    <div class="flex flex-col md:flex-row gap-4 mb-6 bg-blue-50 p-4 rounded-xl">
                        <input id="nav_title_ar" placeholder="ุงููุณู (ุนุฑุจู)" class="input-field">
                        <input id="nav_title_en" placeholder="Section (EN)" class="input-field" dir="ltr">
                        <input id="nav_link" placeholder="#example" class="input-field font-mono" dir="ltr">
                        <button id="nav-add-btn" onclick="addOrUpdateNav()" class="bg-blue-600 text-white px-8 rounded-xl font-bold whitespace-nowrap">ุฅุถุงูุฉ</button>
                        <button id="nav-cancel-btn" onclick="resetNavForm()" class="bg-gray-400 text-white px-4 rounded-xl font-bold hidden">ุฅูุบุงุก</button>
                    </div>
                    <div id="nav-list" class="space-y-3"></div>
                </div>
            </div>

            <!-- ุชุจููุจ: ุงููุฌุจุงุช -->
            <div id="tab-meals" class="tab-content hidden space-y-6">
                <h2 class="text-2xl font-black mb-4">ุฅุฏุงุฑุฉ ุงููุฌุจุงุช</h2>
                <div class="bg-white p-6 rounded-[2rem] shadow-sm border border-gray-100 relative">
                    <h3 class="font-bold text-purple-800 mb-4">ุฅุถุงูุฉ / ุชุนุฏูู ูุฌุจุฉ</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <div class="lg:col-span-3"><label class="text-xs font-bold text-gray-400">ุงููุณู</label><select id="offer_section" class="input-field font-bold text-purple-700"></select></div>
                        <input id="name_ar" placeholder="ุงุณู ุงููุฌุจุฉ (ุนุฑุจู)" class="input-field">
                        <input id="name_en" placeholder="Meal Name (EN)" class="input-field" dir="ltr">
                        <input id="op" type="number" placeholder="ุงูุณุนุฑ" class="input-field">
                        <div class="lg:col-span-2 relative group">
                            <input id="oi" type="text" placeholder="ุฑุงุจุท ุงูุตูุฑุฉ (Image URL)" class="input-field" oninput="updateImagePreview(this.value)">
                            <div class="absolute top-2 left-2 hidden group-hover:block z-10"><img id="img-preview" src="" class="w-16 h-16 rounded-lg object-cover shadow border bg-white"></div>
                        </div>
                        <div class="flex items-center gap-2 bg-gray-50 p-2 rounded-xl border">
                             <span class="text-sm font-bold">ุฎุตูุ</span>
                             <input type="checkbox" id="discount_toggle" class="w-5 h-5" onchange="toggleDiscountField()">
                             <input id="od" type="number" placeholder="%" class="input-field hidden w-20">
                        </div>
                        <textarea id="desc_ar" placeholder="ุงููุตู (ุนุฑุจู)" class="input-field lg:col-span-1" rows="2"></textarea>
                        <textarea id="desc_en" placeholder="Description (EN)" class="input-field lg:col-span-2" rows="2" dir="ltr"></textarea>
                        <!-- ุฑุจุท ุงูุฅุถุงูุงุช -->
                        <div class="lg:col-span-3 bg-blue-50 p-4 rounded-xl border border-blue-100 mt-2">
                            <label class="text-xs font-bold text-gray-500 mb-2 block">ุฑุจุท ุงูุฅุถุงูุงุช:</label>
                            <div id="meal-addons-selection" class="grid grid-cols-2 md:grid-cols-4 gap-2 max-h-32 overflow-y-auto"></div>
                        </div>
                    </div>
                    <div class="flex gap-3 mt-6">
                        <button id="add-btn" onclick="addOrUpdateOffer()" class="flex-1 bg-green-600 text-white py-3 rounded-xl font-bold hover:bg-green-700 transition shadow-lg">ุญูุธ ุงููุฌุจุฉ โ</button>
                        <button id="cancel-btn" onclick="resetForm()" class="hidden px-6 bg-gray-400 text-white rounded-xl font-bold">ุฅูุบุงุก</button>
                    </div>
                </div>
                <div id="list" class="space-y-3 pb-20"></div>
            </div>

            <!-- ุชุจููุจ: ุงููุณุฎ ุงูุงุญุชูุงุทู -->
            <div id="tab-backup" class="tab-content hidden space-y-6">
                <h2 class="text-2xl font-black mb-4">ุงููุณุฎ ุงูุงุญุชูุงุทู ูุงูุงุณุชุนุงุฏุฉ ๐พ</h2>
                <div class="bg-white p-8 rounded-[2rem] shadow-sm border border-gray-100 text-center">
                    <p class="text-gray-500 mb-8 max-w-lg mx-auto">
                        ูุฃู ุงููููุน ูุนูู ุจุฏูู ูุงุนุฏุฉ ุจูุงูุงุช ุณุญุงุจูุฉุ ูุชู ุญูุธ ุงูุจูุงูุงุช ูู ูุชุตูุญู.
                        <br><strong class="text-red-500">ููู ุฌุฏุงู:</strong> ูู ุจุชุญููู ููู ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ ูู ูุชุฑุฉ ูุญูุธ ุจูุงูุงุชู ูู ุงูุถูุงุนุ ูุงุณุชุฎุฏู ูุฐุง ุงูููู ูุชุญุฏูุซ ุจูุงูุงุช ุงููููุน ุนูู GitHub.
                    </p>
                    <div class="flex flex-col md:flex-row justify-center gap-6">
                        <button onclick="downloadBackup()" class="flex items-center justify-center gap-3 bg-purple-600 text-white px-8 py-4 rounded-2xl font-bold hover:bg-purple-700 shadow-lg transition transform hover:-translate-y-1">
                            <span>ุชุญููู ูุณุฎุฉ ุงุญุชูุงุทูุฉ (JSON) โฌ๏ธ</span>
                        </button>
                        <div class="relative overflow-hidden">
                            <button class="flex items-center justify-center gap-3 bg-gray-800 text-white px-8 py-4 rounded-2xl font-bold hover:bg-gray-900 shadow-lg transition w-full">
                                <span>ุงุณุชุนุงุฏุฉ ูุณุฎุฉ ุณุงุจูุฉ โฌ๏ธ</span>
                            </button>
                            <input type="file" id="backup-file" onchange="restoreBackup(this)" class="absolute inset-0 opacity-0 cursor-pointer">
                        </div>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <script>
        // --- ุฅุนุฏุงุฏุงุช Firebase ---
        // ุงุณุชุจุฏู ุงูููู ุฃุฏูุงู ุจุงูููู ุงูุฎุงุตุฉ ุจูุดุฑูุนู (ููู ุฌุฏุงู)
        const firebaseConfig = {
            apiKey: "AIzaSyDaGpSCLGmzonjhwt5DxOLThgvhWe_aqL0",
            authDomain: "backet-89029.firebaseapp.com",
            databaseURL: "https://backet-89029-default-rtdb.firebaseio.com",
            projectId: "backet-89029",
            storageBucket: "backet-89029.firebasestorage.app",
            messagingSenderId: "253242398753",
            appId: "1:253242398753:web:43a02bc6a3e0df036a2b60"
        };

        // ุชููุฆุฉ Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const auth = firebase.auth();
        const db = firebase.database();

        // ูุชุบูุฑุงุช ุนุงูุฉ
        let globalData = {
            siteNavs: [],
            siteOffers: [],
            siteContacts: [],
            siteSocialSettings: { links: [] },
            siteAddonGroups: []
        };
        let tempOptions = [];
        let editIndex = -1;
        let editNavIndex = -1;

        // --- ุงููุตุงุฏูุฉ ---
        auth.onAuthStateChanged((user) => {
            const loader = document.getElementById('loader');
            if (user) {
                document.getElementById('login').style.display = 'none';
                document.getElementById('panel').classList.remove('hidden');
                loader.classList.remove('hidden');
                document.getElementById('loader-text').innerText = 'ุฌุงุฑู ุฌูุจ ุจูุงูุงุชู...';
                loadDataFromFirebase();
            } else {
                document.getElementById('login').style.display = 'flex';
                document.getElementById('panel').classList.add('hidden');
                loader.classList.add('hidden');
            }
        });

        function loginFirebase() {
            const email = document.getElementById('email').value;
            const pass = document.getElementById('password').value;
            const err = document.getElementById('login-error');
            
            document.getElementById('loader').classList.remove('hidden');
            document.getElementById('loader-text').innerText = 'ุฌุงุฑู ุงูุชุญูู...';
            
            auth.signInWithEmailAndPassword(email, pass)
                .catch((error) => {
                    document.getElementById('loader').classList.add('hidden');
                    err.innerText = "ุฎุทุฃ ูู ุงูุฏุฎูู: " + error.message;
                    err.classList.remove('hidden');
                });
        }

        function logoutFirebase() {
            auth.signOut();
        }

        // --- ุฌูุจ ุงูุจูุงูุงุช ูู ุงูุณุญุงุจุฉ ---
        function loadDataFromFirebase() {
            db.ref('/').once('value').then((snapshot) => {
                const data = snapshot.val() || {};
                globalData = { ...globalData, ...data };
                
                // ุงูุชุฃูุฏ ูู ุฃู ุงููุตูููุงุช ูุนุฑูุฉ ุญุชู ูู ูุงูุช ูุงุฑุบุฉ
                globalData.siteNavs = globalData.siteNavs || [];
                globalData.siteOffers = globalData.siteOffers || [];
                globalData.siteContacts = globalData.siteContacts || [];
                globalData.siteSocialSettings = globalData.siteSocialSettings || { links: [] };
                globalData.siteAddonGroups = globalData.siteAddonGroups || [];

                populateFields();
                document.getElementById('loader').classList.add('hidden');
            }).catch(e => {
                alert("ุฎุทุฃ ูู ุงูุงุชุตุงู ุจุงูุจูุงูุงุช: " + e.message);
                document.getElementById('loader').classList.add('hidden');
            });
        }

        // --- ุชุนุจุฆุฉ ุงูุญููู ---
        function populateFields() {
            const d = globalData;
            const setVal = (id, val) => document.getElementById(id).value = val || '';
            const setCheck = (id, val) => document.getElementById(id).checked = (val === true);

            setVal('t_ar', d.siteTitleAr); setVal('t_en', d.siteTitleEn);
            setVal('w', d.whatsappNum); setVal('l', d.siteLogo); setVal('h', d.heroImage);
            
            setVal('hero_t_ar', d.heroTitleAr); setVal('hero_t_en', d.heroTitleEn);
            setVal('hero_d_ar', d.heroDescAr); setVal('hero_d_en', d.heroDescEn);
            
            setVal('footer_title_ar', d.footerTitleAr); setVal('footer_title_en', d.footerTitleEn);
            setVal('footer_desc_ar', d.footerDescAr); setVal('footer_desc_en', d.footerDescEn);
            setVal('map_url', d.mapUrl);
            
            setVal('app_txt_ar', d.appTextAr); setVal('app_txt_en', d.appTextEn); setVal('app_link', d.appLink);
            setCheck('show_app_hero', d.showAppHero); setCheck('show_app_footer', d.showAppFooter);
            
            setVal('copy_ar', d.siteCopyAr); setVal('copy_en', d.siteCopyEn); setVal('copy_link', d.siteCopyLink);

            renderContacts();
            renderNavLinks();
            renderList();
            renderSocialAdmin();
            renderAddonGroupsList();
            renderMealAddonsSelection();
            updateStats();
        }

        // --- ุฏูุงู ุงูุญูุธ ููุณุญุงุจุฉ ---
        function saveDataToFirebase(path, value) {
            document.getElementById('loader').classList.remove('hidden');
            document.getElementById('loader-text').innerText = 'ุฌุงุฑู ุงูุญูุธ...';
            db.ref(path).set(value)
                .then(() => {
                    document.getElementById('loader').classList.add('hidden');
                    if(path === '/') globalData = value; 
                })
                .catch(e => {
                    document.getElementById('loader').classList.add('hidden');
                    alert("ูุดู ุงูุญูุธ: " + e.message);
                });
        }

        function saveMain() {
            const getVal = (id) => document.getElementById(id).value;
            const getCheck = (id) => document.getElementById(id).checked;

            const updates = {
                siteTitleAr: getVal('t_ar'), siteTitleEn: getVal('t_en'),
                whatsappNum: getVal('w'), siteLogo: getVal('l'), heroImage: getVal('h'),
                
                heroTitleAr: getVal('hero_t_ar'), heroTitleEn: getVal('hero_t_en'),
                heroDescAr: getVal('hero_d_ar'), heroDescEn: getVal('hero_d_en'),
                
                footerTitleAr: getVal('footer_title_ar'), footerTitleEn: getVal('footer_title_en'),
                footerDescAr: getVal('footer_desc_ar'), footerDescEn: getVal('footer_desc_en'),
                mapUrl: getVal('map_url'),
                
                appTextAr: getVal('app_txt_ar'), appTextEn: getVal('app_txt_en'), appLink: getVal('app_link'),
                showAppHero: getCheck('show_app_hero'), showAppFooter: getCheck('show_app_footer'),
                
                siteCopyAr: getVal('copy_ar'), siteCopyEn: getVal('copy_en'), siteCopyLink: getVal('copy_link')
            };

            document.getElementById('loader').classList.remove('hidden');
            document.getElementById('loader-text').innerText = 'ุฌุงุฑู ุงูุญูุธ ูู ุงูุณุญุงุจุฉ...';
            
            db.ref('/').update(updates).then(() => {
                globalData = { ...globalData, ...updates };
                document.getElementById('loader').classList.add('hidden');
                alert("ุชู ุญูุธ ุงูุฅุนุฏุงุฏุงุช ูู ุงูุณุญุงุจุฉ โ๏ธโ");
            });
        }

        // --- ุฅุฏุงุฑุฉ ุงูููุงุฆู ---
        
        // 1. ุฌูุงุช ุงูุงุชุตุงู
        function renderContacts() {
            document.getElementById('contact-list').innerHTML = globalData.siteContacts.map((c, i) => `
                <div class="flex justify-between items-center bg-white p-2 rounded-lg border text-sm">
                    <span class="font-bold">${c.type === 'phone' ? '๐ฑ' : '๐ง'} ${c.value}</span>
                    <button onclick="removeContact(${i})" class="text-red-500 px-2">x</button>
                </div>
            `).join('');
        }
        function addContact() {
            const type = document.getElementById('contact_type').value;
            const value = document.getElementById('contact_val').value;
            if(!value) return;
            globalData.siteContacts.push({ type, value });
            saveDataToFirebase('siteContacts', globalData.siteContacts);
            document.getElementById('contact_val').value = '';
            renderContacts();
        }
        function removeContact(i) {
            globalData.siteContacts.splice(i, 1);
            saveDataToFirebase('siteContacts', globalData.siteContacts);
            renderContacts();
        }

        // 2. ุงูุณูุดูุงู ููุฏูุง
        function renderSocialAdmin() {
            const d = globalData.siteSocialSettings;
            document.getElementById('show_social_top').checked = d.showTop;
            document.getElementById('show_social_bottom').checked = d.showBottom;
            document.getElementById('social-list-admin').innerHTML = d.links.map((link, i) => `
                <div class="flex items-center justify-between bg-gray-50 p-2 rounded border">
                    <span>${link.platform}</span>
                    <button onclick="deleteSocialLink(${i})" class="text-red-500 font-bold">ุญุฐู</button>
                </div>
            `).join('');
        }
        function addSocialLink() {
            const platform = document.getElementById('social_platform').value;
            const url = document.getElementById('social_link').value;
            if(!url) return;
            globalData.siteSocialSettings.links.push({ platform, url });
            saveSocialSettings(false); 
            document.getElementById('social_link').value = '';
            renderSocialAdmin();
        }
        function deleteSocialLink(i) {
            globalData.siteSocialSettings.links.splice(i, 1);
            saveSocialSettings(false);
            renderSocialAdmin();
        }
        function saveSocialSettings(alertUser = true) {
            globalData.siteSocialSettings.showTop = document.getElementById('show_social_top').checked;
            globalData.siteSocialSettings.showBottom = document.getElementById('show_social_bottom').checked;
            
            document.getElementById('loader').classList.remove('hidden');
            db.ref('siteSocialSettings').set(globalData.siteSocialSettings).then(() => {
                document.getElementById('loader').classList.add('hidden');
                if(alertUser) alert("ุชู ุงูุญูุธ โ");
            });
        }

        // 3. ุงูุฅุถุงูุงุช (Addons)
        function addTempOption() {
            const ar = document.getElementById('opt_name_ar').value;
            const en = document.getElementById('opt_name_en').value;
            const price = document.getElementById('opt_price').value || 0;
            if(!ar) return alert("ุงูุงุณู ูุทููุจ");
            tempOptions.push({ nameAr: ar, nameEn: en, price: parseFloat(price) });
            renderTempOptions();
            document.getElementById('opt_name_ar').value = ''; document.getElementById('opt_name_en').value = ''; document.getElementById('opt_price').value = '';
        }
        function renderTempOptions() {
            document.getElementById('temp-options-list').innerHTML = tempOptions.map((o, i) => `
                <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-xs">${o.nameAr} <button onclick="tempOptions.splice(${i},1); renderTempOptions()">x</button></span>
            `).join('');
        }
        function saveAddonGroup() {
            const titleAr = document.getElementById('addon_group_ar').value;
            const titleEn = document.getElementById('addon_group_en').value;
            const type = document.getElementById('addon_type').value;
            if(!titleAr || tempOptions.length === 0) return alert("ุจูุงูุงุช ูุงูุตุฉ");
            
            globalData.siteAddonGroups.push({ id: Date.now(), titleAr, titleEn, type, options: tempOptions });
            saveDataToFirebase('siteAddonGroups', globalData.siteAddonGroups);
            
            document.getElementById('addon_group_ar').value = ''; document.getElementById('addon_group_en').value = '';
            tempOptions = []; renderTempOptions(); renderAddonGroupsList(); renderMealAddonsSelection();
            alert("ุชู ุญูุธ ุงููุฌููุนุฉ!");
        }
        function renderAddonGroupsList() {
            document.getElementById('addons-list').innerHTML = globalData.siteAddonGroups.map((g, i) => `
                <div class="bg-gray-50 p-4 rounded border flex justify-between">
                    <b>${g.titleAr}</b> <button onclick="deleteAddonGroup(${i})" class="text-red-500">ุญุฐู</button>
                </div>
            `).join('');
        }
        function deleteAddonGroup(i) {
            if(confirm('ุญุฐูุ')) {
                globalData.siteAddonGroups.splice(i, 1);
                saveDataToFirebase('siteAddonGroups', globalData.siteAddonGroups);
                renderAddonGroupsList(); renderMealAddonsSelection();
            }
        }
        function renderMealAddonsSelection() {
            const container = document.getElementById('meal-addons-selection');
            if(globalData.siteAddonGroups.length === 0) { container.innerHTML = 'ูุง ุชูุฌุฏ ุฅุถุงูุงุช'; return; }
            container.innerHTML = globalData.siteAddonGroups.map(g => `
                <label class="flex items-center gap-2 bg-white p-2 rounded border">
                    <input type="checkbox" value="${g.id}" class="addon-checkbox"> <span class="text-xs font-bold">${g.titleAr}</span>
                </label>
            `).join('');
        }

        // 4. ุงูุฃูุณุงู
        function renderNavLinks() {
            document.getElementById('nav-list').innerHTML = globalData.siteNavs.map((n, i) => `
                <div class="flex justify-between bg-gray-50 p-3 rounded border">
                    <div>${n.titleAr}</div>
                    <div>
                        <button onclick="toggleNav(${i})">${n.isHidden ? '๐๏ธ' : '๐ซ'}</button>
                        <button onclick="editNav(${i})">โ๏ธ</button>
                        <button onclick="deleteNav(${i})" class="text-red-500">๐๏ธ</button>
                    </div>
                </div>
            `).join('');
            const sel = document.getElementById('offer_section');
            sel.innerHTML = globalData.siteNavs.filter(n => n.link.startsWith('#') && !n.isHidden).map(s => `<option value="${s.link}">${s.titleAr}</option>`).join('');
            updateStats();
        }
        function addOrUpdateNav() {
            const titleAr = document.getElementById('nav_title_ar').value;
            const link = document.getElementById('nav_link').value;
            if(!titleAr) return;
            const newItem = { titleAr, titleEn: document.getElementById('nav_title_en').value, link, isHidden: false };
            
            if(editNavIndex === -1) globalData.siteNavs.push(newItem);
            else globalData.siteNavs[editNavIndex] = { ...globalData.siteNavs[editNavIndex], ...newItem };
            
            saveDataToFirebase('siteNavs', globalData.siteNavs);
            resetNavForm(); renderNavLinks();
        }
        function deleteNav(i) {
            if(confirm('ุญุฐูุ')) { globalData.siteNavs.splice(i, 1); saveDataToFirebase('siteNavs', globalData.siteNavs); renderNavLinks(); }
        }
        function toggleNav(i) {
            globalData.siteNavs[i].isHidden = !globalData.siteNavs[i].isHidden;
            saveDataToFirebase('siteNavs', globalData.siteNavs);
            renderNavLinks();
        }
        function editNav(i) {
            const n = globalData.siteNavs[i];
            document.getElementById('nav_title_ar').value = n.titleAr;
            document.getElementById('nav_title_en').value = n.titleEn;
            document.getElementById('nav_link').value = n.link;
            editNavIndex = i;
            document.getElementById('nav-add-btn').innerText = "ุชุญุฏูุซ";
            document.getElementById('nav-cancel-btn').classList.remove('hidden');
        }
        function resetNavForm() {
            editNavIndex = -1;
            document.getElementById('nav_title_ar').value = ''; document.getElementById('nav_title_en').value = ''; document.getElementById('nav_link').value = '';
            document.getElementById('nav-add-btn').innerText = "ุฅุถุงูุฉ"; document.getElementById('nav-cancel-btn').classList.add('hidden');
        }

        // 5. ุงููุฌุจุงุช
        function renderList() {
            document.getElementById('list').innerHTML = globalData.siteOffers.map((o, i) => `
                <div class="flex justify-between items-center bg-white p-4 rounded border mb-2">
                    <div class="flex items-center gap-4">
                        <img src="${o.img}" class="w-12 h-12 rounded bg-gray-100">
                        <div><b>${o.nameAr}</b> <span class="text-xs text-gray-500">${o.price} ุฑ.ุณ</span></div>
                    </div>
                    <div>
                        <button onclick="editOffer(${i})" class="text-blue-500 px-2">ุชุนุฏูู</button>
                        <button onclick="deleteOffer(${i})" class="text-red-500 px-2">ุญุฐู</button>
                    </div>
                </div>
            `).join('');
            updateStats();
        }
        function addOrUpdateOffer() {
            const section = document.getElementById('offer_section').value;
            const nameAr = document.getElementById('name_ar').value;
            const price = document.getElementById('op').value;
            const selectedAddons = Array.from(document.querySelectorAll('.addon-checkbox:checked')).map(cb => parseInt(cb.value));

            if(!section || !nameAr || !price) return alert("ุจูุงูุงุช ูุงูุตุฉ");

            const data = {
                section, nameAr, nameEn: document.getElementById('name_en').value,
                descAr: document.getElementById('desc_ar').value, descEn: document.getElementById('desc_en').value,
                price, discount: document.getElementById('discount_toggle').checked ? document.getElementById('od').value : "",
                img: document.getElementById('oi').value,
                linkedAddons: selectedAddons
            };

            if(editIndex === -1) globalData.siteOffers.push(data);
            else globalData.siteOffers[editIndex] = data;

            saveDataToFirebase('siteOffers', globalData.siteOffers);
            renderList(); resetForm(); alert('ุชู ุงูุญูุธ!');
        }
        function editOffer(i) {
            let o = globalData.siteOffers[i];
            const sel = document.getElementById('offer_section');
            sel.value = o.section; 
            document.getElementById('name_ar').value = o.nameAr; document.getElementById('name_en').value = o.nameEn;
            document.getElementById('op').value = o.price; document.getElementById('oi').value = o.img;
            updateImagePreview(o.img);
            document.getElementById('desc_ar').value = o.descAr; document.getElementById('desc_en').value = o.descEn;
            
            if(o.discount) { document.getElementById('discount_toggle').checked = true; document.getElementById('od').value = o.discount; document.getElementById('od').classList.remove('hidden'); } 
            else { document.getElementById('discount_toggle').checked = false; document.getElementById('od').classList.add('hidden'); }

            const checkboxes = document.querySelectorAll('.addon-checkbox');
            checkboxes.forEach(cb => cb.checked = false);
            if(o.linkedAddons) o.linkedAddons.forEach(id => { 
                const cb = document.querySelector(`.addon-checkbox[value="${id}"]`); if(cb) cb.checked = true; 
            });

            editIndex = i; document.getElementById('add-btn').innerText = "ุญูุธ ุงูุชุนุฏููุงุช"; document.getElementById('cancel-btn').classList.remove('hidden');
            document.querySelector('.tab-content:not(.hidden)').scrollTo({top: 0, behavior: 'smooth'});
        }
        function deleteOffer(i) {
            if(confirm('ุญุฐูุ')) {
                globalData.siteOffers.splice(i, 1);
                saveDataToFirebase('siteOffers', globalData.siteOffers);
                renderList();
            }
        }
        function resetForm() {
            editIndex = -1; document.querySelectorAll('#tab-meals input, #tab-meals textarea').forEach(i => i.value = '');
            document.querySelectorAll('.addon-checkbox').forEach(cb => cb.checked = false);
            document.getElementById('discount_toggle').checked = false; document.getElementById('od').classList.add('hidden');
            document.getElementById('img-preview').parentElement.classList.add('hidden');
            document.getElementById('add-btn').innerText = "ุญูุธ ุงููุฌุจุฉ โ"; document.getElementById('cancel-btn').classList.add('hidden');
        }
        function updateImagePreview(url) {
            const img = document.getElementById('img-preview');
            if(url) { img.src = url; img.parentElement.classList.remove('hidden'); } else { img.parentElement.classList.add('hidden'); }
        }
        function toggleDiscountField() {
            const checked = document.getElementById('discount_toggle').checked;
            const input = document.getElementById('od');
            checked ? input.classList.remove('hidden') : input.classList.add('hidden');
            if(!checked) input.value = '';
        }
        function updateStats() {
            document.getElementById('stat-meals').innerText = globalData.siteOffers.length;
            document.getElementById('stat-sections').innerText = globalData.siteNavs.length;
        }
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            document.querySelectorAll('.sidebar-btn').forEach(el => el.classList.remove('active', 'bg-[#423064]', 'text-white'));
            document.getElementById(`tab-${tabName}`).classList.remove('hidden');
            const btn = document.getElementById(`btn-${tabName}`);
            if(btn) { btn.classList.add('active'); if(!btn.classList.contains('text-blue-600')) btn.classList.add('bg-[#423064]', 'text-white'); }
        }
    </script>
</body>
</html>

